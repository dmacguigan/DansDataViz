<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan MacGuigan">
<meta name="dcterms.date" content="2024-02-22">

<title>Dan’s Data Viz - Hockey Hat Tricks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.27.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dan’s Data Viz</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Dan MacGuigan, Ph.D.</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dmacguigan" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/dmacguigan" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Hockey Hat Tricks</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">API</div>
                <div class="quarto-category">visualization</div>
                <div class="quarto-category">sports</div>
                <div class="quarto-category">hockey</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dan MacGuigan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>In hockey (and some other sports), a hat trick is three goals scored by the same player in a single game. How common are hat tricks in the NHL?</p>
<p>We’ll again turn to the NHL’s <a href="https://www.nhl.com/stats/">stats database</a>, with API documentation help from <a href="https://gitlab.com/dword4/nhlapi/-/blob/master/new-api.md">here</a> and <a href="https://github.com/Zmalski/NHL-API-Reference?tab=readme-ov-file#get-team-roster-by-season">here</a>.</p>
<p>First, let’s just look at the 2022-2023 season for one team. How about the Buffalo Sabres? We’ll need to loop through every Sabres game from this season and find games with hat tricks.</p>
<p>Let’s look at the data structure. Here’s the first Sabres game that season.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>team <span class="op">=</span> <span class="st">"BUF"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> <span class="dv">20222023</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/club-schedule-season/"</span> <span class="op">+</span> <span class="bu">str</span>(team) <span class="op">+</span> <span class="st">"/"</span> <span class="op">+</span> <span class="bu">str</span>(season)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(link)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>sched <span class="op">=</span> json.loads(requests.get(link).text) <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>game1 <span class="op">=</span> sched[<span class="st">"games"</span>][<span class="dv">0</span>] <span class="co"># look at the first game</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(game1, indent<span class="op">=</span><span class="dv">4</span>)) <span class="co"># print the new dictionary object</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>game1_date <span class="op">=</span> game1[<span class="st">"gameDate"</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The date of the Sabres first game this season is: "</span> <span class="op">+</span> <span class="bu">str</span>(game1_date))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>game1_ID <span class="op">=</span> game1[<span class="st">"id"</span>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The ID of the Sabres first game this season is: "</span> <span class="op">+</span> <span class="bu">str</span>(game1_ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="scrolling">
<div class="cell" data-execution_count="2">
<div class="cell-output cell-output-stdout">
<pre><code>https://api-web.nhle.com/v1/club-schedule-season/BUF/20222023
{
    "id": 2022010006,
    "season": 20222023,
    "gameType": 1,
    "gameDate": "2022-09-25",
    "venue": {
        "default": "Capital One Arena"
    },
    "neutralSite": false,
    "startTimeUTC": "2022-09-25T18:00:00Z",
    "easternUTCOffset": "-04:00",
    "venueUTCOffset": "-04:00",
    "venueTimezone": "US/Eastern",
    "gameState": "FINAL",
    "gameScheduleState": "OK",
    "tvBroadcasts": [
        {
            "id": 320,
            "market": "H",
            "countryCode": "US",
            "network": "NBCSWA",
            "sequenceNumber": 1
        },
        {
            "id": 324,
            "market": "N",
            "countryCode": "US",
            "network": "NHLN",
            "sequenceNumber": 1
        }
    ],
    "awayTeam": {
        "id": 7,
        "placeName": {
            "default": "Buffalo"
        },
        "abbrev": "BUF",
        "logo": "https://assets.nhle.com/logos/nhl/svg/BUF_light.svg",
        "darkLogo": "https://assets.nhle.com/logos/nhl/svg/BUF_dark.svg",
        "awaySplitSquad": false,
        "score": 4
    },
    "homeTeam": {
        "id": 15,
        "placeName": {
            "default": "Washington"
        },
        "abbrev": "WSH",
        "logo": "https://assets.nhle.com/logos/nhl/svg/WSH_light.svg",
        "darkLogo": "https://assets.nhle.com/logos/nhl/svg/WSH_dark.svg",
        "homeSplitSquad": false,
        "score": 3
    },
    "periodDescriptor": {
        "periodType": "OT"
    },
    "gameOutcome": {
        "lastPeriodType": "OT"
    },
    "winningGoalie": {
        "playerId": 8480045,
        "firstInitial": {
            "default": "U."
        },
        "lastName": {
            "default": "Luukkonen"
        }
    },
    "winningGoalScorer": {
        "playerId": 8476994,
        "firstInitial": {
            "default": "V."
        },
        "lastName": {
            "default": "Hinostroza"
        }
    },
    "gameCenterLink": "/gamecenter/buf-vs-wsh/2022/09/25/2022010006"
}

The date of the Sabres first game this season is: 2022-09-25
The ID of the Sabres first game this season is: 2022010006</code></pre>
</div>
</div>
</div>
<p><br></p>
<p>Unfortunately, this data structure doesn’t show us the goals scored by each player. To find that, we’ll need to cross reference a different database.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/score/"</span> <span class="op">+</span> <span class="bu">str</span>(game1_date)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>box_scores <span class="op">=</span> json.loads(requests.get(link).text)[<span class="st">"games"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>game1_score <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> box_scores <span class="cf">if</span> item[<span class="st">'id'</span>] <span class="op">==</span> game1_ID) <span class="co"># find the Sabres game using the game ID from our previous bit of code</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(game1_score, indent<span class="op">=</span><span class="dv">4</span>)) <span class="co"># print the new dictionary object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="scrolling">
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>{
    "id": 2022010006,
    "season": 20222023,
    "gameType": 1,
    "gameDate": "2022-09-25",
    "venue": {
        "default": "Capital One Arena"
    },
    "startTimeUTC": "2022-09-25T18:00:00Z",
    "easternUTCOffset": "-04:00",
    "venueUTCOffset": "-04:00",
    "tvBroadcasts": [
        {
            "id": 320,
            "market": "H",
            "countryCode": "US",
            "network": "NBCSWA",
            "sequenceNumber": 1
        },
        {
            "id": 324,
            "market": "N",
            "countryCode": "US",
            "network": "NHLN",
            "sequenceNumber": 1
        }
    ],
    "gameState": "FINAL",
    "gameScheduleState": "OK",
    "awayTeam": {
        "id": 7,
        "name": {
            "default": "Sabres"
        },
        "abbrev": "BUF",
        "score": 4,
        "sog": 28,
        "logo": "https://assets.nhle.com/logos/nhl/svg/BUF_light.svg"
    },
    "homeTeam": {
        "id": 15,
        "name": {
            "default": "Capitals"
        },
        "abbrev": "WSH",
        "score": 3,
        "sog": 27,
        "logo": "https://assets.nhle.com/logos/nhl/svg/WSH_light.svg"
    },
    "gameCenterLink": "/gamecenter/buf-vs-wsh/2022/09/25/2022010006",
    "clock": {
        "timeRemaining": "03:45",
        "secondsRemaining": 225,
        "running": false,
        "inIntermission": false
    },
    "neutralSite": false,
    "venueTimezone": "US/Eastern",
    "period": 4,
    "periodDescriptor": {
        "number": 4,
        "periodType": "OT"
    },
    "gameOutcome": {
        "lastPeriodType": "OT",
        "otPeriods": 1
    },
    "goals": [
        {
            "period": 1,
            "periodDescriptor": {
                "number": 1,
                "periodType": "REG"
            },
            "timeInPeriod": "04:05",
            "playerId": 8477511,
            "name": {
                "default": "A. Mantha"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/WSH/8477511.png",
            "teamAbbrev": "WSH",
            "goalsToDate": 1,
            "awayScore": 0,
            "homeScore": 1,
            "strength": "PP",
            "highlightClip": 6335818566112
        },
        {
            "period": 2,
            "periodDescriptor": {
                "number": 2,
                "periodType": "REG"
            },
            "timeInPeriod": "04:25",
            "playerId": 8481528,
            "name": {
                "default": "D. Cozens"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/BUF/8481528.png",
            "teamAbbrev": "BUF",
            "goalsToDate": 1,
            "awayScore": 1,
            "homeScore": 1,
            "strength": "PP",
            "highlightClip": 6335819727112
        },
        {
            "period": 2,
            "periodDescriptor": {
                "number": 2,
                "periodType": "REG"
            },
            "timeInPeriod": "09:16",
            "playerId": 8482896,
            "name": {
                "default": "T. Kozak"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/BUF/8482896.png",
            "teamAbbrev": "BUF",
            "goalsToDate": 1,
            "awayScore": 2,
            "homeScore": 1,
            "strength": "EV",
            "highlightClip": 6335819725112
        },
        {
            "period": 2,
            "periodDescriptor": {
                "number": 2,
                "periodType": "REG"
            },
            "timeInPeriod": "09:42",
            "playerId": 8477839,
            "name": {
                "default": "C. Sheary"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/WSH/8477839.png",
            "teamAbbrev": "WSH",
            "goalsToDate": 1,
            "awayScore": 2,
            "homeScore": 2,
            "strength": "EV",
            "highlightClip": 6335818367112
        },
        {
            "period": 3,
            "periodDescriptor": {
                "number": 3,
                "periodType": "REG"
            },
            "timeInPeriod": "05:43",
            "playerId": 8481441,
            "name": {
                "default": "J. Snively"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/WSH/8481441.png",
            "teamAbbrev": "WSH",
            "goalsToDate": 1,
            "awayScore": 2,
            "homeScore": 3,
            "strength": "EV",
            "highlightClip": 6335819254112
        },
        {
            "period": 3,
            "periodDescriptor": {
                "number": 3,
                "periodType": "REG"
            },
            "timeInPeriod": "18:55",
            "playerId": 8482097,
            "name": {
                "default": "J. Quinn"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/BUF/8482097.png",
            "teamAbbrev": "BUF",
            "goalsToDate": 1,
            "awayScore": 3,
            "homeScore": 3,
            "strength": "PP",
            "highlightClip": 6335820218112
        },
        {
            "period": 4,
            "periodDescriptor": {
                "number": 4,
                "periodType": "OT"
            },
            "timeInPeriod": "01:15",
            "playerId": 8476994,
            "name": {
                "default": "V. Hinostroza"
            },
            "mugshot": "https://assets.nhle.com/mugs/nhl/20222023/BUF/8476994.png",
            "teamAbbrev": "BUF",
            "goalsToDate": 1,
            "awayScore": 4,
            "homeScore": 3,
            "strength": "EV",
            "highlightClip": 6335820905112
        }
    ]
}</code></pre>
</div>
</div>
</div>
<p><br></p>
<p>This data structure has info on each goal scored this game. Let’s figure out a way to tally the number of goals scored by each player. We’ll use the <code>Counter</code> function from the <code>collections</code> library.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> collections</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>scorers <span class="op">=</span> [i[<span class="st">"playerId"</span>] <span class="cf">for</span> i <span class="kw">in</span> game1_score[<span class="st">'goals'</span>]] <span class="co"># extract player IDs for each goal scored</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>scorers_table <span class="op">=</span> <span class="bu">dict</span>(collections.Counter(scorers)) <span class="co"># count how many goals are scored by each player</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"goals scored by player ID"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(scorers_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>goals scored by player ID
{8477511: 1, 8481528: 1, 8482896: 1, 8477839: 1, 8481441: 1, 8482097: 1, 8476994: 1}</code></pre>
</div>
</div>
<p><br></p>
<p>Now that we’ve got the basics, we can set up a loop to go through all Sabres games in the 2022-2023 season.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>team <span class="op">=</span> <span class="st">"BUF"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> <span class="dv">20222023</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/club-schedule-season/"</span> <span class="op">+</span> <span class="bu">str</span>(team) <span class="op">+</span> <span class="st">"/"</span> <span class="op">+</span> <span class="bu">str</span>(season)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sched <span class="op">=</span> json.loads(requests.get(link).text) <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(team <span class="op">+</span> <span class="st">" games with hat tricks..."</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"date:</span><span class="sc">{{</span><span class="st">player_ID: [number_of_goals, player_name]</span><span class="sc">}}</span><span class="st">"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> game <span class="kw">in</span> sched[<span class="st">"games"</span>]: <span class="co"># loop through every focal team game in the schedule</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  gameDATE <span class="op">=</span> game[<span class="st">"gameDate"</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  gameID <span class="op">=</span> game[<span class="st">"id"</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  link2 <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/score/"</span> <span class="op">+</span> <span class="bu">str</span>(gameDATE)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  box_scores <span class="op">=</span> json.loads(requests.get(link2).text)[<span class="st">"games"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  score <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> box_scores <span class="cf">if</span> item[<span class="st">'id'</span>] <span class="op">==</span> gameID) <span class="co"># find the game using the game ID from our previous bit of code</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  team_goals <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> score[<span class="st">'goals'</span>] <span class="cf">if</span> d[<span class="st">'teamAbbrev'</span>] <span class="kw">in</span> team] <span class="co"># only get goals scored by the team</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  scorers <span class="op">=</span> [i[<span class="st">"playerId"</span>] <span class="cf">for</span> i <span class="kw">in</span> team_goals] <span class="co"># extract player IDs for each goal scored</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  scorers_table <span class="op">=</span> <span class="bu">dict</span>(collections.Counter(scorers))  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  hat_tricks_scorers <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> scorers_table.items() <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">3</span>) <span class="co"># get scorers with more than 3 goals</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> key <span class="kw">in</span> hat_tricks_scorers: <span class="co"># loop through hat trick scorers</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    player <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> team_goals <span class="cf">if</span> item[<span class="st">'playerId'</span>]<span class="op">==</span> key)[<span class="st">'name'</span>][<span class="st">'default'</span>] <span class="co"># get player name based on player ID</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    hat_tricks_scorers[key] <span class="op">=</span> [hat_tricks_scorers[key]] <span class="co"># convert dict value to list</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    hat_tricks_scorers[key] <span class="op">+=</span> [player] <span class="co"># add player name as a value to player ID key</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">bool</span>(hat_tricks_scorers): <span class="co"># only return results if there was a hat trick</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(gameDATE <span class="op">+</span> <span class="st">":"</span> <span class="op">+</span> <span class="bu">str</span>(hat_tricks_scorers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="scrolling">
<div class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code>BUF games with hat tricks...
date:{{player_ID: [number_of_goals, player_name]}}
2022-10-20:{8477949: [3, 'A. Tuch']}
2022-10-31:{8479420: [3, 'T. Thompson']}
2022-12-07:{8479420: [5, 'T. Thompson']}
2022-12-29:{8473449: [3, 'K. Okposo']}
2023-01-03:{8479420: [3, 'T. Thompson']}
2023-02-23:{8479420: [3, 'T. Thompson']}
2023-02-26:{8481528: [3, 'D. Cozens']}
2023-04-01:{8477949: [3, 'A. Tuch']}</code></pre>
</div>
</div>
</div>
<p><br></p>
<p>Tage Thompson had 4 hat tricks that season, impressive!</p>
<p>We can expand this to look at all teams in the 2022-2023 season. It will take a little while to run this code. We’ll use the <code>datetime</code> and <code>dateutil</code> libraries to loop through every day in that season. Also, let’s only look at regular season games (<code>"gameType": 2</code>). Lastly, we also need to ignore shootout goals (encoded by the <code>periodDescriptor</code> value), since these aren’t counted toward a hat trick.</p>
<p>This code will take a few minutes to run.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, timedelta</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dateutil.parser <span class="im">as</span> dateparser</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> <span class="dv">20222023</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get start and end date of season</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>standings <span class="op">=</span> json.loads(requests.get(<span class="st">"https://api-web.nhle.com/v1/standings-season"</span>).text)[<span class="st">"seasons"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> dateparser.parse(<span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> standings <span class="cf">if</span> item[<span class="st">"id"</span>] <span class="op">==</span> season)[<span class="st">"standingsStart"</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> dateparser.parse(<span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> standings <span class="cf">if</span> item[<span class="st">"id"</span>] <span class="op">==</span> season)[<span class="st">"standingsEnd"</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>delta <span class="op">=</span> timedelta(days<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>all_hat_tricks <span class="op">=</span> {}</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> start_date.date() <span class="op">&lt;=</span> end_date.date():</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> start_date.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    link2 <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/score/"</span> <span class="op">+</span> <span class="bu">str</span>(date)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    box_scores <span class="op">=</span> json.loads(requests.get(link2).text)[<span class="st">"games"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    hat_tricks_scorers_date <span class="op">=</span> {} <span class="co"># empty dictionary to contain all hat trick scorers on this date</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(box_scores): <span class="co"># only look at dates with games</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> game <span class="kw">in</span> box_scores: <span class="co"># loop through each game on each date</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> game[<span class="st">'gameType'</span>] <span class="op">==</span> <span class="dv">2</span>: <span class="co"># only look at regular season games</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>          goals <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> game[<span class="st">"goals"</span>] <span class="cf">if</span> d[<span class="st">'periodDescriptor'</span>][<span class="st">'periodType'</span>] <span class="op">!=</span> <span class="st">"SO"</span>] <span class="co"># ignore shootout goals</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>          scorers <span class="op">=</span> [i[<span class="st">"playerId"</span>] <span class="cf">for</span> i <span class="kw">in</span> goals] <span class="co"># extract player IDs for each goal scored</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>          scorers_table <span class="op">=</span> <span class="bu">dict</span>(collections.Counter(scorers))  </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>          hat_tricks_scorers <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> scorers_table.items() <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">3</span>) <span class="co"># get scorers with more than 3 goals</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> <span class="bu">bool</span>(hat_tricks_scorers): <span class="co"># if there was a hat trick in this game</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key <span class="kw">in</span> hat_tricks_scorers: <span class="co"># loop through hat trick scorers</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>              player <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> goals <span class="cf">if</span> item[<span class="st">'playerId'</span>] <span class="op">==</span> key)[<span class="st">'name'</span>][<span class="st">'default'</span>] <span class="co"># get player name based on player ID</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>              team <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> goals <span class="cf">if</span> item[<span class="st">'playerId'</span>] <span class="op">==</span> key)[<span class="st">'teamAbbrev'</span>] <span class="co"># get player name based on player ID</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>              hat_tricks_scorers[key] <span class="op">=</span> [hat_tricks_scorers[key]] <span class="co"># convert dict value to list</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>              hat_tricks_scorers[key] <span class="op">+=</span> [player] <span class="co"># add player name as a value to player ID key</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>              hat_tricks_scorers[key] <span class="op">+=</span> [team] <span class="co"># add team abbreviation as a value to player ID key</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>              hat_tricks_scorers_date[key] <span class="op">=</span> hat_tricks_scorers[key] <span class="co"># update the date dictionary</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(hat_tricks_scorers_date): <span class="co"># if there was a hat trick on this date, update the main hat tricks dictionary </span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      all_hat_tricks[date] <span class="op">=</span> hat_tricks_scorers_date</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">+=</span> delta <span class="co"># increment date by 1</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"hat tricks were scored during "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(all_hat_tricks)) <span class="op">+</span> <span class="st">" games in the 2022-2023 NHL season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>hat tricks were scored during 66 games in the 2022-2023 NHL season</code></pre>
</div>
</div>
<p>Let’s convert our messy <code>all_hat_tricks</code> dictionary to a cleaner data frame.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> all_hat_tricks: <span class="co"># loop through all dates</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> all_hat_tricks[i]: <span class="co"># loop through all hat tricks each date</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    df_data.append([i, j, all_hat_tricks[i][j][<span class="dv">1</span>], all_hat_tricks[i][j][<span class="dv">2</span>], all_hat_tricks[i][j][<span class="dv">0</span>]]) <span class="co"># write data for each hat trick to list of list</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>all_hat_tricks_df <span class="op">=</span> pd.DataFrame(df_data, columns<span class="op">=</span>[<span class="st">'date'</span>, <span class="st">'player_ID'</span>, <span class="st">'player_name'</span>, <span class="st">'team'</span>, <span class="st">'goals'</span>]) <span class="co"># convert list of lists to dataframe</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_hat_tricks_df.head(<span class="dv">5</span>)) <span class="co"># print first five rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         date  player_ID    player_name team  goals
0  2022-10-12    8478402     C. McDavid  EDM      3
1  2022-10-20    8480830  A. Svechnikov  CAR      3
2  2022-10-20    8477949        A. Tuch  BUF      3
3  2022-10-22    8470794    J. Pavelski  DAL      3
4  2022-10-27    8478402     C. McDavid  EDM      3</code></pre>
</div>
</div>
<p><br></p>
<p>Nice, that should be easier to work with. How many hat tricks were there in the 2022-2023 season?</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Number of hat tricks in the 2022-2023 season: "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(all_hat_tricks_df)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of hat tricks in the 2022-2023 season: 96</code></pre>
</div>
</div>
<p><br></p>
<p>How about a quick plot?</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>all_hat_tricks_df[<span class="st">'hat_tricks'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">1</span> <span class="op">+</span> <span class="bu">len</span>(all_hat_tricks_df))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(all_hat_tricks_df, x<span class="op">=</span><span class="st">'date'</span>, y<span class="op">=</span><span class="st">"hat_tricks"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a> title <span class="op">=</span> <span class="st">"NHL 2022-2023 Season Hat Tricks"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a> template<span class="op">=</span><span class="st">"plotly_dark"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a> line_shape<span class="op">=</span><span class="st">'hv'</span>) <span class="co"># line_shape will plot lines as steps</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"number of hat tricks"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>fig.update_traces(line_color<span class="op">=</span><span class="st">'cyan'</span>, line_width<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce margins for better viewing on mobile</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span><span class="bu">dict</span>(l<span class="op">=</span><span class="dv">20</span>, r<span class="op">=</span><span class="dv">20</span>, b<span class="op">=</span><span class="dv">20</span>))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="404a743a-a8f4-4aae-9611-7607613cf11d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("404a743a-a8f4-4aae-9611-7607613cf11d")) {                    Plotly.newPlot(                        "404a743a-a8f4-4aae-9611-7607613cf11d",                        [{"hovertemplate":"date=%{x}\u003cbr\u003ehat_tricks=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","line":{"color":"cyan","dash":"solid","shape":"hv","width":3},"marker":{"symbol":"circle"},"mode":"lines","name":"","orientation":"v","showlegend":false,"x":["2022-10-12","2022-10-20","2022-10-20","2022-10-22","2022-10-27","2022-10-29","2022-10-31","2022-11-01","2022-11-01","2022-11-02","2022-11-03","2022-11-04","2022-11-04","2022-11-05","2022-11-10","2022-11-10","2022-11-16","2022-11-17","2022-11-23","2022-11-26","2022-11-29","2022-12-01","2022-12-01","2022-12-03","2022-12-04","2022-12-07","2022-12-11","2022-12-11","2022-12-13","2022-12-13","2022-12-13","2022-12-16","2022-12-17","2022-12-19","2022-12-29","2022-12-29","2022-12-29","2022-12-31","2022-12-31","2023-01-03","2023-01-03","2023-01-07","2023-01-07","2023-01-07","2023-01-08","2023-01-08","2023-01-11","2023-01-14","2023-01-14","2023-01-17","2023-01-18","2023-01-21","2023-01-22","2023-01-26","2023-01-26","2023-02-11","2023-02-11","2023-02-16","2023-02-19","2023-02-21","2023-02-23","2023-02-26","2023-02-26","2023-02-28","2023-02-28","2023-03-02","2023-03-04","2023-03-05","2023-03-11","2023-03-14","2023-03-15","2023-03-17","2023-03-18","2023-03-18","2023-03-18","2023-03-19","2023-03-19","2023-03-19","2023-03-25","2023-03-27","2023-03-28","2023-03-30","2023-04-01","2023-04-01","2023-04-01","2023-04-01","2023-04-01","2023-04-02","2023-04-04","2023-04-06","2023-04-06","2023-04-09","2023-04-12","2023-04-13","2023-04-13","2023-04-14"],"xaxis":"x","y":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"number of hat tricks"}},"legend":{"tracegroupgap":0},"title":{"text":"NHL 2022-2023 Season Hat Tricks"},"margin":{"l":20,"r":20,"b":20}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('404a743a-a8f4-4aae-9611-7607613cf11d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p><br></p>
<p>I wonder which NHL season had the most hat tricks per game played. To answer this question, we can loop over all NHL seasons and extract the hat trick data.</p>
<p>This code will take a few hours to run since we’re doing a lot of API queries.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, timedelta</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dateutil.parser <span class="im">as</span> dateparser</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get start and end date of season</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>standings <span class="op">=</span> json.loads(requests.get(<span class="st">"https://api-web.nhle.com/v1/standings-season"</span>).text)[<span class="st">"seasons"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># data structures to store results</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>every_hat_trick<span class="op">=</span>[]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season<span class="op">=</span>[] </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> season <span class="kw">in</span> standings:</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  season_id <span class="op">=</span> season[<span class="st">'id'</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> season_id <span class="op">!=</span> <span class="dv">20232024</span>: <span class="co"># skip current season</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> dateparser.parse(season[<span class="st">"standingsStart"</span>])</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> dateparser.parse(season[<span class="st">"standingsEnd"</span>])</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> timedelta(days<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    season_games <span class="op">=</span> <span class="dv">0</span> <span class="co"># counter for the number of games in the season</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    season_hat_tricks <span class="op">=</span> <span class="dv">0</span> <span class="co"># counter for the number of hat tricks</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> start_date.date() <span class="op">&lt;=</span> end_date.date():</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> start_date.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        link2 <span class="op">=</span> <span class="st">"https://api-web.nhle.com/v1/score/"</span> <span class="op">+</span> <span class="bu">str</span>(date)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        box_scores <span class="op">=</span> json.loads(requests.get(link2).text)[<span class="st">"games"</span>] <span class="co"># pull request, get data (.text), and convert JSON to a Python dict</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        hat_tricks_scorers_date <span class="op">=</span> {} <span class="co"># empty dictionary to contain all hat trick scorers on this date</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(box_scores): <span class="co"># only look at dates with games</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> game <span class="kw">in</span> box_scores: <span class="co"># loop through each game on each date</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> game[<span class="st">'gameType'</span>] <span class="op">==</span> <span class="dv">2</span>: <span class="co"># only look at regular season games</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>              season_games <span class="op">+=</span> <span class="dv">1</span> <span class="co"># increment the number of games for the season</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>              goals <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> game[<span class="st">"goals"</span>] <span class="cf">if</span> d[<span class="st">'periodDescriptor'</span>][<span class="st">'periodType'</span>] <span class="op">!=</span> <span class="st">"SO"</span>] <span class="co"># ignore shootout goals</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>              scorers <span class="op">=</span> [i[<span class="st">"playerId"</span>] <span class="cf">for</span> i <span class="kw">in</span> goals] <span class="co"># extract player IDs for each goal scored</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>              scorers_table <span class="op">=</span> <span class="bu">dict</span>(collections.Counter(scorers))  <span class="co"># count the number of goals per player</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>              hat_tricks_scorers <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> scorers_table.items() <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">3</span>) <span class="co"># get scorers with more than 3 goals</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> <span class="bu">bool</span>(hat_tricks_scorers): <span class="co"># if there was a hat trick in this game</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key <span class="kw">in</span> hat_tricks_scorers: <span class="co"># loop through hat trick scorers</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>                  player <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> goals <span class="cf">if</span> item[<span class="st">'playerId'</span>] <span class="op">==</span> key)[<span class="st">'name'</span>][<span class="st">'default'</span>] <span class="co"># get player name based on player ID</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>                  team <span class="op">=</span> <span class="bu">next</span>(item <span class="cf">for</span> item <span class="kw">in</span> goals <span class="cf">if</span> item[<span class="st">'playerId'</span>] <span class="op">==</span> key)[<span class="st">'teamAbbrev'</span>] <span class="co"># get player name based on player ID</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>                  game_id <span class="op">=</span> game[<span class="st">'id'</span>]</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>                  temp <span class="op">=</span> [season_id, game_id, team, key, player, hat_tricks_scorers[key]]</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                  every_hat_trick.append(temp) <span class="co"># add hat trick data to list</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                  season_hat_tricks <span class="op">+=</span> <span class="dv">1</span> <span class="co"># increment number of hat tricks for the season</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>        start_date <span class="op">+=</span> delta <span class="co"># increment date by 1</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    hat_tricks_by_season.append([season_id, season_games, season_hat_tricks]) <span class="co"># add new season data to list</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">str</span>(season_id) <span class="op">+</span> <span class="st">", games = "</span> <span class="op">+</span> <span class="bu">str</span>(season_games) <span class="op">+</span> <span class="st">", hat tricks = "</span> <span class="op">+</span> <span class="bu">str</span>(season_hat_tricks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="scrolling">
<div class="cell" data-execution_count="13">
<div class="cell-output cell-output-stdout">
<pre><code>19171918, games = 36, hat tricks = 37
19181919, games = 27, hat tricks = 16
19191920, games = 48, hat tricks = 35
19201921, games = 48, hat tricks = 20
19211922, games = 48, hat tricks = 25
19221923, games = 48, hat tricks = 17
19231924, games = 48, hat tricks = 5
19241925, games = 90, hat tricks = 18
19251926, games = 126, hat tricks = 18
19261927, games = 220, hat tricks = 16
19271928, games = 220, hat tricks = 24
19281929, games = 220, hat tricks = 4
19291930, games = 220, hat tricks = 35
19301931, games = 220, hat tricks = 20
19311932, games = 192, hat tricks = 18
19321933, games = 216, hat tricks = 17
19331934, games = 216, hat tricks = 19
19341935, games = 216, hat tricks = 13
19351936, games = 192, hat tricks = 11
19361937, games = 192, hat tricks = 16
19371938, games = 192, hat tricks = 11
19381939, games = 168, hat tricks = 14
19391940, games = 168, hat tricks = 7
19401941, games = 168, hat tricks = 6
19411942, games = 168, hat tricks = 12
19421943, games = 150, hat tricks = 23
19431944, games = 150, hat tricks = 43
19441945, games = 150, hat tricks = 22
19451946, games = 150, hat tricks = 19
19461947, games = 180, hat tricks = 26
19471948, games = 180, hat tricks = 15
19481949, games = 180, hat tricks = 7
19491950, games = 210, hat tricks = 10
19501951, games = 210, hat tricks = 13
19511952, games = 210, hat tricks = 14
19521953, games = 210, hat tricks = 10
19531954, games = 210, hat tricks = 11
19541955, games = 210, hat tricks = 15
19551956, games = 210, hat tricks = 10
19561957, games = 210, hat tricks = 14
19571958, games = 210, hat tricks = 16
19581959, games = 210, hat tricks = 21
19591960, games = 210, hat tricks = 15
19601961, games = 210, hat tricks = 21
19611962, games = 210, hat tricks = 14
19621963, games = 210, hat tricks = 14
19631964, games = 210, hat tricks = 13
19641965, games = 210, hat tricks = 12
19651966, games = 210, hat tricks = 22
19661967, games = 210, hat tricks = 18
19671968, games = 444, hat tricks = 41
19681969, games = 456, hat tricks = 41
19691970, games = 456, hat tricks = 36
19701971, games = 546, hat tricks = 52
19711972, games = 546, hat tricks = 53
19721973, games = 624, hat tricks = 66
19731974, games = 624, hat tricks = 66
19741975, games = 720, hat tricks = 85
19751976, games = 720, hat tricks = 89
19761977, games = 720, hat tricks = 59
19771978, games = 720, hat tricks = 69
19781979, games = 680, hat tricks = 73
19791980, games = 840, hat tricks = 81
19801981, games = 840, hat tricks = 133
19811982, games = 840, hat tricks = 139
19821983, games = 840, hat tricks = 108
19831984, games = 840, hat tricks = 113
19841985, games = 840, hat tricks = 113
19851986, games = 840, hat tricks = 114
19861987, games = 840, hat tricks = 97
19871988, games = 840, hat tricks = 113
19881989, games = 840, hat tricks = 119
19891990, games = 840, hat tricks = 88
19901991, games = 840, hat tricks = 71
19911992, games = 880, hat tricks = 101
19921993, games = 1008, hat tricks = 112
19931994, games = 1092, hat tricks = 91
19941995, games = 624, hat tricks = 48
19951996, games = 1066, hat tricks = 93
19961997, games = 1066, hat tricks = 74
19971998, games = 1066, hat tricks = 64
19981999, games = 1107, hat tricks = 56
19992000, games = 1148, hat tricks = 53
20002001, games = 1230, hat tricks = 93
20012002, games = 1230, hat tricks = 57
20022003, games = 1230, hat tricks = 75
20032004, games = 1230, hat tricks = 46
20052006, games = 1230, hat tricks = 79
20062007, games = 1230, hat tricks = 71
20072008, games = 1230, hat tricks = 73
20082009, games = 1230, hat tricks = 65
20092010, games = 1230, hat tricks = 67
20102011, games = 1230, hat tricks = 76
20112012, games = 1230, hat tricks = 55
20122013, games = 720, hat tricks = 32
20132014, games = 1230, hat tricks = 56
20142015, games = 1230, hat tricks = 49
20152016, games = 1230, hat tricks = 67
20162017, games = 1230, hat tricks = 59
20172018, games = 1271, hat tricks = 81
20182019, games = 1271, hat tricks = 97
20192020, games = 1082, hat tricks = 67
20202021, games = 868, hat tricks = 60
20212022, games = 1312, hat tricks = 102
20222023, games = 1312, hat tricks = 96</code></pre>
</div>
</div>
</div>
<p><br></p>
<p>Phew, finally done. Let’s answer our question about which season has the highest rate of hat tricks.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df <span class="op">=</span> pd.DataFrame(hat_tricks_by_season, columns<span class="op">=</span>[<span class="st">'season_long'</span>, <span class="st">'games'</span>, <span class="st">'hat_tricks'</span>]) <span class="co"># convert list of lists to dataframe</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df[<span class="st">'hat_tricks_per_game'</span>] <span class="op">=</span> <span class="bu">round</span>(hat_tricks_by_season_df[<span class="st">'hat_tricks'</span>] <span class="op">/</span> hat_tricks_by_season_df[<span class="st">'games'</span>], <span class="dv">3</span>) <span class="co"># calculate number of hat tricks per game</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df[<span class="st">'temp'</span>] <span class="op">=</span> hat_tricks_by_season_df[<span class="st">'season_long'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df[<span class="st">'temp1'</span>] <span class="op">=</span> hat_tricks_by_season_df[<span class="st">'temp'</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">4</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df[<span class="st">'temp2'</span>] <span class="op">=</span> hat_tricks_by_season_df[<span class="st">'temp'</span>].<span class="bu">str</span>[<span class="op">-</span><span class="dv">4</span>:]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>hat_tricks_by_season_df[<span class="st">'season'</span>] <span class="op">=</span> hat_tricks_by_season_df[[<span class="st">'temp1'</span>, <span class="st">'temp2'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="st">'-'</span>.join(row.values.astype(<span class="bu">str</span>)), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(hat_tricks_by_season_df, y<span class="op">=</span><span class="st">'hat_tricks_per_game'</span>, x<span class="op">=</span><span class="bu">str</span>(<span class="st">'season'</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  template<span class="op">=</span><span class="st">"plotly_dark"</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  hover_name<span class="op">=</span><span class="st">'season'</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  title <span class="op">=</span> <span class="st">"NHL Hat Trick Rate by Season"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"hat tricks per game"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>fig.update_traces(marker_color<span class="op">=</span><span class="st">"cyan"</span>) </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce margins for better viewing on mobile</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span><span class="bu">dict</span>(l<span class="op">=</span><span class="dv">20</span>, r<span class="op">=</span><span class="dv">20</span>, b<span class="op">=</span><span class="dv">20</span>))</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="e20c118f-e19c-4155-b80a-ba77a3f1171d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("e20c118f-e19c-4155-b80a-ba77a3f1171d")) {                    Plotly.newPlot(                        "e20c118f-e19c-4155-b80a-ba77a3f1171d",                        [{"alignmentgroup":"True","hovertemplate":"\u003cb\u003e%{hovertext}\u003c\u002fb\u003e\u003cbr\u003e\u003cbr\u003eseason=%{x}\u003cbr\u003ehat_tricks_per_game=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","hovertext":["1917-1918","1918-1919","1919-1920","1920-1921","1921-1922","1922-1923","1923-1924","1924-1925","1925-1926","1926-1927","1927-1928","1928-1929","1929-1930","1930-1931","1931-1932","1932-1933","1933-1934","1934-1935","1935-1936","1936-1937","1937-1938","1938-1939","1939-1940","1940-1941","1941-1942","1942-1943","1943-1944","1944-1945","1945-1946","1946-1947","1947-1948","1948-1949","1949-1950","1950-1951","1951-1952","1952-1953","1953-1954","1954-1955","1955-1956","1956-1957","1957-1958","1958-1959","1959-1960","1960-1961","1961-1962","1962-1963","1963-1964","1964-1965","1965-1966","1966-1967","1967-1968","1968-1969","1969-1970","1970-1971","1971-1972","1972-1973","1973-1974","1974-1975","1975-1976","1976-1977","1977-1978","1978-1979","1979-1980","1980-1981","1981-1982","1982-1983","1983-1984","1984-1985","1985-1986","1986-1987","1987-1988","1988-1989","1989-1990","1990-1991","1991-1992","1992-1993","1993-1994","1994-1995","1995-1996","1996-1997","1997-1998","1998-1999","1999-2000","2000-2001","2001-2002","2002-2003","2003-2004","2005-2006","2006-2007","2007-2008","2008-2009","2009-2010","2010-2011","2011-2012","2012-2013","2013-2014","2014-2015","2015-2016","2016-2017","2017-2018","2018-2019","2019-2020","2020-2021","2021-2022","2022-2023"],"legendgroup":"","marker":{"color":"cyan","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["1917-1918","1918-1919","1919-1920","1920-1921","1921-1922","1922-1923","1923-1924","1924-1925","1925-1926","1926-1927","1927-1928","1928-1929","1929-1930","1930-1931","1931-1932","1932-1933","1933-1934","1934-1935","1935-1936","1936-1937","1937-1938","1938-1939","1939-1940","1940-1941","1941-1942","1942-1943","1943-1944","1944-1945","1945-1946","1946-1947","1947-1948","1948-1949","1949-1950","1950-1951","1951-1952","1952-1953","1953-1954","1954-1955","1955-1956","1956-1957","1957-1958","1958-1959","1959-1960","1960-1961","1961-1962","1962-1963","1963-1964","1964-1965","1965-1966","1966-1967","1967-1968","1968-1969","1969-1970","1970-1971","1971-1972","1972-1973","1973-1974","1974-1975","1975-1976","1976-1977","1977-1978","1978-1979","1979-1980","1980-1981","1981-1982","1982-1983","1983-1984","1984-1985","1985-1986","1986-1987","1987-1988","1988-1989","1989-1990","1990-1991","1991-1992","1992-1993","1993-1994","1994-1995","1995-1996","1996-1997","1997-1998","1998-1999","1999-2000","2000-2001","2001-2002","2002-2003","2003-2004","2005-2006","2006-2007","2007-2008","2008-2009","2009-2010","2010-2011","2011-2012","2012-2013","2013-2014","2014-2015","2015-2016","2016-2017","2017-2018","2018-2019","2019-2020","2020-2021","2021-2022","2022-2023"],"xaxis":"x","y":[1.028,0.593,0.729,0.417,0.521,0.354,0.104,0.2,0.143,0.073,0.109,0.018,0.159,0.091,0.094,0.079,0.088,0.06,0.057,0.083,0.057,0.083,0.042,0.036,0.071,0.153,0.287,0.147,0.127,0.144,0.083,0.039,0.048,0.062,0.067,0.048,0.052,0.071,0.048,0.067,0.076,0.1,0.071,0.1,0.067,0.067,0.062,0.057,0.105,0.086,0.092,0.09,0.079,0.095,0.097,0.106,0.106,0.118,0.124,0.082,0.096,0.107,0.096,0.158,0.165,0.129,0.135,0.135,0.136,0.115,0.135,0.142,0.105,0.085,0.115,0.111,0.083,0.077,0.087,0.069,0.06,0.051,0.046,0.076,0.046,0.061,0.037,0.064,0.058,0.059,0.053,0.054,0.062,0.045,0.044,0.046,0.04,0.054,0.048,0.064,0.076,0.062,0.069,0.078,0.073],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"season"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"hat tricks per game"}},"legend":{"tracegroupgap":0},"title":{"text":"NHL Hat Trick Rate by Season"},"barmode":"relative","margin":{"l":20,"r":20,"b":20}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('e20c118f-e19c-4155-b80a-ba77a3f1171d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p><br></p>
<p>The NHL’s early seasons were the golden age of hat tricks. On average, there was actually more than one hat trick per game during the very first season! The rate of hat tricks declined drastically in the 1920s and 30s.</p>
<p>So what caused this decline? Probably many factors. First, improved goalie equipment coupled with rule changes led to a decline in scoring. According to <a href="https://www.hockey-reference.com/leagues/stats.html">hockey-reference.com</a>, teams averaged 4.75 goals per game during the 1917-1918 NHL season. Compare that to only 3.18 goals per game in 2022-2023 season.</p>
<p>Second, and perhaps more importantly, team rosters have gotten larger. In the early years of the NHL, only 9 skaters per team were allowed to play during any given game. Todays teams have twice as many skaters per game. More players on the team means less ice time for any given player and fewer opportunities to rack up goals.</p>
<p>A complete analysis of hat trick rates would require consideration of these factors and more.</p>
<p>One last question. How many times has more than one hat trick been scored in an NHL game?</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>every_hat_trick_df <span class="op">=</span> pd.DataFrame(every_hat_trick, columns<span class="op">=</span>[<span class="st">'season_id'</span>, <span class="st">"game_id"</span>, <span class="st">'team'</span>, <span class="st">'player_id'</span>, <span class="st">'player'</span>, <span class="st">'goals'</span>]) <span class="co"># convert list of lists to dataframe</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"there have been "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(every_hat_trick_df.index)) <span class="op">+</span> <span class="st">" hat tricks in NHL history"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>games_hts <span class="op">=</span> <span class="bu">dict</span>(collections.Counter(every_hat_trick_df[<span class="st">'game_id'</span>])) <span class="co"># count hat tricks for each game</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>multi_ht_games <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> games_hts.items() <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">2</span>) <span class="co"># get only games with multiple hat tricks</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"there have been "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(multi_ht_games)) <span class="op">+</span> <span class="st">" games with multiple hat tricks"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>three_ht_games <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> games_hts.items() <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="dv">3</span>) <span class="co"># get only games with more than 3 hat tricks</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"there have been "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(three_ht_games)) <span class="op">+</span> <span class="st">" games with more than 3 hat tricks"</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># find the game with the most hat tricks</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>max_hts <span class="op">=</span> <span class="bu">max</span>(games_hts.values())</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>n_games_max <span class="op">=</span> <span class="bu">sum</span>(value <span class="op">==</span> max_hts <span class="cf">for</span> value <span class="kw">in</span> games_hts.values()) <span class="co"># how many games have the max number of hat tricks?</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>max_ht_games <span class="op">=</span> <span class="bu">dict</span>((k, v) <span class="cf">for</span> k, v <span class="kw">in</span> games_hts.items() <span class="cf">if</span> v <span class="op">&gt;=</span> max_hts) <span class="co"># get only games with multiple hat tricks</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"the maximum number of hat tricks scored in an NHL game is "</span> <span class="op">+</span> <span class="bu">str</span>(max_hts))</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"there have been "</span> <span class="op">+</span> <span class="bu">str</span>(n_games_max) <span class="op">+</span> <span class="st">" games with "</span> <span class="op">+</span> <span class="bu">str</span>(max_hts) <span class="op">+</span> <span class="st">" hat tricks"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> max_ht_games:</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"game "</span> <span class="op">+</span> <span class="bu">str</span>(c) <span class="op">+</span> <span class="st">":"</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  max_hts_df <span class="op">=</span> every_hat_trick_df.loc[every_hat_trick_df[<span class="st">'game_id'</span>] <span class="op">==</span> i]</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(max_hts_df)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  c <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>there have been 5086 hat tricks in NHL history

there have been 239 games with multiple hat tricks

there have been 18 games with more than 3 hat tricks

the maximum number of hat tricks scored in an NHL game is 4
there have been 3 games with 4 hat tricks
game 1:
   season_id     game_id team  player_id      player  goals
4   19171918  1917020003  TAN    8447832  H. Meeking      3
5   19171918  1917020003  TAN    8445873  C. Denneny      3
6   19171918  1917020003  TAN    8448013    R. Noble      3
7   19171918  1917020003  SEN    8445874  C. Denneny      3
game 2:
    season_id     game_id team  player_id       player  goals
59   19191920  1919020011  MTL    8448154     D. Pitre      3
60   19191920  1919020011  MTL    8447289   N. Lalonde      6
61   19191920  1919020011  MTL    8445496  O. Cleghorn      3
62   19191920  1919020011  TSP    8448013     R. Noble      3
game 3:
    season_id     game_id team  player_id       player  goals
76   19191920  1919020042  MTL    8448154     D. Pitre      3
77   19191920  1919020042  MTL    8445496  O. Cleghorn      3
78   19191920  1919020042  MTL    8447289   N. Lalonde      4
79   19191920  1919020042  MTL    8445314   H. Cameron      4</code></pre>
</div>
</div>
<p><br></p>
<p>Wow, three games with four hat tricks each!</p>
<p>Let’s look at the first game with four hat tricks. We can look at the <a href="https://www.hockey-reference.com/boxscores/191712220TRA.html">box score</a> for this game where the Toronto Arenas (TAN) blew out the Ottawa Senators (SEN) by a score of 11-4. However, one Ottawa player still managed to score a hat trick.</p>
<p>Ottawa’s hat trick was scored by a player named “C. Denneny.” Weirdly, there was also a Toronto hat trick scorer named “C. Denneny.” As it turns out, Corb Denneny (Toronto) and Cy Denneny (Ottawa) were brothers! Both are now members of the Hockey Hall of Fame.</p>
<p>I wonder how many times brothers or relatives have scored hat tricks in the same game.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"the following games have multiple hat tricks scored by players with the same last name:"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> multi_ht_games:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  temp <span class="op">=</span> every_hat_trick_df[every_hat_trick_df[<span class="st">'game_id'</span>] <span class="op">==</span> i] <span class="co"># get data for multi hat trick games</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  temp2 <span class="op">=</span> temp[<span class="st">'player'</span>].<span class="bu">str</span>[<span class="dv">3</span>:].tolist() <span class="co"># convert player column to list</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  temp2_set <span class="op">=</span> <span class="bu">set</span>(temp2) <span class="co"># create set</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(temp2) <span class="op">!=</span> <span class="bu">len</span>(temp2_set): <span class="co"># if lengths are not equal, list contains duplicate values</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    brother_hts <span class="op">=</span> every_hat_trick_df.loc[every_hat_trick_df[<span class="st">'game_id'</span>] <span class="op">==</span> i]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(brother_hts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="scrolling">
<div class="cell" data-execution_count="17">
<div class="cell-output cell-output-stdout">
<pre><code>the following games have multiple hat tricks scored by players with the same last name:

game 1:
   season_id     game_id team  player_id      player  goals
4   19171918  1917020003  TAN    8447832  H. Meeking      3
5   19171918  1917020003  TAN    8445873  C. Denneny      3
6   19171918  1917020003  TAN    8448013    R. Noble      3
7   19171918  1917020003  SEN    8445874  C. Denneny      3
game 2:
    season_id     game_id team  player_id      player  goals
17   19171918  1917020013  SEN    8445844  J. Darragh      3
18   19171918  1917020013  SEN    8445874  C. Denneny      3
19   19171918  1917020013  TAN    8445873  C. Denneny      3
game 3:
     season_id     game_id team  player_id       player  goals
112   19211922  1921020018  MTL    8445497  S. Cleghorn      4
113   19211922  1921020018  MTL    8445496  O. Cleghorn      4
game 4:
     season_id     game_id team  player_id      player  goals
127   19211922  1921020041  TSP    8445873  C. Denneny      3
128   19211922  1921020041  SEN    8445874  C. Denneny      4
game 5:
     season_id     game_id team  player_id      player  goals
557   19461947  1946020149  CHI    8445062  D. Bentley      4
558   19461947  1946020149  NYR    8449363  G. Warwick      3
559   19461947  1946020149  CHI    8445063  M. Bentley      3
game 6:
      season_id     game_id team  player_id      player  goals
1757   19801981  1980020621  QUE    8451689  P. Stastny      3
1758   19801981  1980020621  QUE    8451688  A. Stastny      3
game 7:
      season_id     game_id team  player_id      player  goals
1761   19801981  1980020636  QUE    8451689  P. Stastny      4
1762   19801981  1980020636  QUE    8451688  A. Stastny      3
1763   19801981  1980020636  QUE    8450815  J. Richard      3</code></pre>
</div>
</div>
</div>
<p><br></p>
<p>There have been seven NHL games where two players with the same last name both scored hat tricks! Turns out our brothers from the previous code block, Corb Denneny and Cy Denneny, have actually scored hat tricks together three separate times.</p>
<p>Odie and Sprague Cleghorn are another pair of brothers who scored a hat trick in the same game, but this time they both played for the same team. In 1946, brother Dough and Max Bentley achieved a similar feat while both playing for the Chicago Blackhawks.</p>
<p>And lastly, brothers Peter and Anton Šťastný of the Quebec Nordiques scored hat tricks together twice in the 1980-1981 season. This was their first year in the NHL, having just defected to Canada from communist Czechoslovakia.</p>
<p>This is one of my favorite things about digging through sports databases. You can find all manner of strange statistical anomalies and reveal fascinating human stories that might have otherwise been lost to time.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>